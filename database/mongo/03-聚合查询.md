# 聚合(aggregate)

```sh
db.<collection>.aggregate(pipeline,options)
```

| 步聚                 | 作用     | SQL等价运算符     |
| -------------------- | -------- | ----------------- |
| `$match`             | 过滤     | `where`           |
| `$project`           | 投影     | `AS`              |
| `$sort`              | 排序     | `ORDER BY`        |
| `$group`             | 分组     | `GROUP BY`        |
| `$skip`/`$limit`     | 结果限制 | `OFFSET/LIMIT`    |
| `$lookup`            | 左外连接 | `LEFT OUTER JOIN` |
| `$unwind`            | 展开数组 | N/A               |
| `$graphLookup`       | 图搜索   | N/A               |
| **`$facet/$bucket`** | 分面搜索 | N/A               |


| 表达式      | 描述                                         | 实例                                                         |
| :---------- | :------------------------------------------- | :----------------------------------------------------------- |
| `$sum`      | 计算总和.                                    | db.mycol.aggregate([{$group : {_id : "$by_user", num_tutorial : {$sum : "$likes"}}}]) |
| `$avg`      | 计算平均值                                   | db.mycol.aggregate([{$group : {_id : "$by_user", num_tutorial : {$avg : "$likes"}}}]) |
| `$min`      | 获取集合中所有文档对应值得最小值.            | db.mycol.aggregate([{$group : {_id : "$by_user", num_tutorial : {$min : "$likes"}}}]) |
| `$max`      | 获取集合中所有文档对应值得最大值.            | db.mycol.aggregate([{$group : {_id : "$by_user", num_tutorial : {$max : "$likes"}}}]) |
| `$push`     | 在结果文档中插入值到一个数组中.              | db.mycol.aggregate([{$group : {_id : "$by_user", url : {$push: "$url"}}}]) |
| `$addToSet` | 在结果文档中插入值到一个数组中,但不创建副本. | db.mycol.aggregate([{$group : {_id : "$by_user", url : {$addToSet : "$url"}}}]) |
| `$first`    | 根据资源文档的排序获取第一个文档数据.        | db.mycol.aggregate([{$group : {_id : "$by_user", first_url : {$first : "$url"}}}]) |
| `$last`     | 根据资源文档的排序获取最后一个文档数据       | db.mycol.aggregate([{$group : {_id : "$by_user", last_url : {$last : "$url"}}}]) |









