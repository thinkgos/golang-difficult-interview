[TOC]

# 分片集群与运维

## 一. 常见部署架构

- 单机版
- 复制集
- 分片集群

## 二. 分片集群设计

需要多少个分片

> A=所需存储总量/单服务可挂载容量         	  8TB/2TB = 4
>
> B=工作集大小/单服务内存容量*0.6				400GB/(256G * 0.6)
>
> C=并发量总数/(集群服务器并发量 * 0.7)   	30000/(9000 * 0.7) 
>
> 分片数量 = MAX(A,B,C)

考虑分片的分布:

> - 是否需要跨机房分布分 片?
> - 是否需要容灾?
> - 高可用的要求如何?

## 三. 概念

概念由小到大:

- 片键shard key: 文档中的一个或多个字段
- 文档doc: 包含 shard key的一行数据
- 块chunk: 包含n个文档 
- 分片shard: 包含n个chunk
- 集群cluster: 包含 n个分片

1. 分片健效率的主要因素
   - 取值基数(Cardinality)
   - 取值分布
   - 分散写,集中读
   - 被尽可能多的业务场景用到
   - 避免单调递增或递减的片键







