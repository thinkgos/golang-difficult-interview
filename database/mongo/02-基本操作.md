[TOC]

# 基本操作

## 一. 数据库

| 命令                | 解释                                            |
| ------------------- | ----------------------------------------------- |
| `show dbs`          | 显示数据库                                      |
| `use <db_name>`     | 如果数据库不存在则创建数据库,否则使用指定数据库 |
| `db`                | 显示当前在数据库                                |
| `db.dropDatabase()` | 删除当前数据库                                  |

##  二 集合

| 命令                                        | 解释           |
| ------------------------------------------- | -------------- |
| `show tables|collections`                   | 显示集合       |
| `db.<collection>.drop()`                    | 删除集合       |
| `db.createCollection(<collection>,options)` | 显示的创建集合 |

`db.createCollection(name, options)`

**option**可选参数如下： 

| 字段          | 类型 | 描述                                                         |
| :------------ | :--- | :----------------------------------------------------------- |
| `capped`      | 布尔 | (可选）如果为 true,则创建固定集合.<br />固定集合是指有着固定大小的集合,当达到最大值时,它会自动覆盖最早的文档.<br /> **当该值为 true 时,必须指定 size 参数.** |
| `autoIndexId` | 布尔 | (可选）3.2 之后不再支持该参数<br />如为 true,自动在 _id 字段创建索引.默认为 false. |
| `size`        | 数值 | (可选）为固定集合指定一个最大值,即字节数.<br /> **如果 capped 为 true,也需要指定该字段.** |
| `max`         | 数值 | (可选）指定固定集合中包含文档的最大数量.                     |

## 三. 文档

### 1. 插入文档

- MongoDB中的所有写操作都是单个文档级别的[原子](https://docs.mongodb.com/master/core/write-operations-atomicity/)操作

- `save(document)`：如果 _id 主键存在则更新数据,如果不存在就插入数据.该方法新版本中已废弃,可以使用 **db.collection.insertOne()** 或 **db.collection.replaceOne()** 来代替.

- `insert(document)`: 若插入的数据主键已经存在,则会抛 **org.springframework.dao.DuplicateKeyException** 异常,提示主键重复,不保存当前数据.

- `insertOne(document)`: 用于向集合插入一个新文档

- `insertMany(document,{writeConcern: <doc>, ordered: <boolean>})`: 用于向集合插入一个多个文档

  > - document：要写入的文档.
  > - writeConcern：写入策略,默认为 1,即要求确认写操作,0 是不要求.
  > - ordered：指定是否按顺序写入,默认 true,按顺序写入

### 2. 更新文档

```
db.collection.update(
   <query>,
   <update>,
   {
     upsert: <boolean>,
     multi: <boolean>,
     writeConcern: <document>
   }
)
```

- **query** : update的查询条件,类似sql update查询内where后面的.
- **update** : update的对象和一些更新的操作符(如$,$inc...）等,也可以理解为sql update查询内set后面的
- **upsert** : 可选,这个参数的意思是,如果不存在update的记录,是否插入objNew,true为插入,默认是false,不插入.
- **multi** : 可选,mongodb 默认是false,只更新找到的第一条记录,如果这个参数为true,就把按条件查出来多条记录全部更新.
- **writeConcern** :可选,抛出异常的级别.

### 3. 删除文档

```
db.collection.remove(
   <query>,
   {
     justOne: <boolean>,
     writeConcern: <document>
   }
)
```

- **query** :(可选）删除的文档的条件.
- **justOne** : (可选）如果设为 true 或 1,则只删除一个文档,如果不设置该参数,或使用默认值 false,则删除所有匹配条件的文档.
- **writeConcern** :(可选）抛出异常的级别.

### 4. 查询

```
db.collection.find(query, projection)
```

- **query** ：可选,使用查询操作符指定查询条件
- **projection** ：可选,使用投影操作符指定返回的键.查询时返回文档中所有键值, 只需省略该参数即可(默认省略）

## 二. 其它 

- `sort({KEY: 1})`: 对数据进行排序,Key 值为你要排序的字段,使用 `1` 和 `-1` 来指定排序的方式,其中 `1` 为升序排列,而 `-1` 是用于降序排列

- 索引: 

  - `createIndex(keys,options)`创建索引, Key 值为你要创建的索引字段,1 为指定按升序创建索引,如果你想按降序来创建索引指定为 -1 即可

  > | Parameter          | Type          | Description                                                  |
  > | :----------------- | :------------ | :----------------------------------------------------------- |
  > | background         | Boolean       | 建索引过程会阻塞其它数据库操作,background可指定以后台方式创建索引,即增加 "background" 可选参数. "background" 默认值为**false**. |
  > | unique             | Boolean       | 建立的索引是否唯一.指定为true创建唯一索引.默认值为**false**. |
  > | name               | string        | 索引的名称.如果未指定,MongoDB的通过连接索引的字段名和排序顺序生成一个索引名称. |
  > | dropDups           | Boolean       | **3.0+版本已废弃.**在建立唯一索引时是否删除重复记录,指定 true 创建唯一索引.默认值为 **false**. |
  > | sparse             | Boolean       | 对文档中不存在的字段数据不启用索引；这个参数需要特别注意,如果设置为true的话,在索引字段中不会查询出不包含对应字段的文档..默认值为 **false**. |
  > | expireAfterSeconds | integer       | 指定一个以秒为单位的数值,完成 TTL设定,设定集合的生存时间.    |
  > | v                  | index version | 索引的版本号.默认的索引版本取决于mongod创建索引时运行的版本. |
  > | weights            | document      | 索引权重值,数值在 1 到 99,999 之间,表示该索引相对于其他索引字段的得分权重. |
  > | default_language   | string        | 对于文本索引,该参数决定了停用词及词干和词器的规则的列表. 默认为英语 |
  > | language_override  | string        | 对于文本索引,该参数指定了包含在文档中的字段名,语言覆盖默认的language,默认值为 language |

  - `getIndees()`查看集合索引
  - `totalIndexSize()`查看集合索引大小
  - `dropIndexes()`删除集合所有索引
  - `dropIndexes(<collection>)`删除集合指定索引












